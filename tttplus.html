<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unlimited Tic Tac Toe</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
        }

        h1 {
            margin: 20px;
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
            width: min(90vmin, 90vw); /* Đảm bảo bảng luôn vuông dựa trên kích thước màn hình */
            aspect-ratio: 1 / 1; /* Tỷ lệ 1:1 để giữ ô vuông */
            gap: 2px;
            margin-bottom: 20px;
        }

        .cell {
            width: 100%;
            height: 100%;
            background-color: lightblue;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            cursor: pointer;
            border: 1px solid darkblue;
        }

        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
        }

        .x {
            background-color: black;
            color: white;
        }

        .o {
            background-color: red;
            color: white;
        }

        #winner {
            font-weight: bold;
            font-size: 1.5rem;
        }
    </style>
</head>

<body>
    <h1>Unlimited Tic-Tac-Toe</h1>
    <div id="game-board"></div>
    <h1 id="whowin">Make your move!</h1>
    <button id="reset">Reset Game</button>

    <script>
        const boardSize = 20; // Kích thước lưới 20x20, có thể thay đổi tuỳ ý
        const board = Array(boardSize).fill(null).map(() => Array(boardSize).fill(""));
        const humanPlayer = "X";
        const aiPlayer = "O";
        const winCondition = 5;

        const gameBoard = document.getElementById('game-board');
        const winnerDisplay = document.getElementById('whowin');
        const resetButton = document.getElementById('reset');

        resetButton.addEventListener('click', resetGame);

        // Tạo bảng với số ô tương ứng
        function createBoard() {
            gameBoard.innerHTML = '';
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize; col++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.setAttribute('data-row', row);
                    cell.setAttribute('data-col', col);
                    cell.addEventListener('click', handleCellClick);
                    gameBoard.appendChild(cell);
                }
            }
        }

        createBoard();

        function handleCellClick(e) {
            const row = e.target.getAttribute('data-row');
            const col = e.target.getAttribute('data-col');

            if (board[row][col] === "") {
                makeMove(row, col, humanPlayer);
                if (!checkWin(humanPlayer) && !isBoardFull()) {
                    setTimeout(() => {
                        const bestMove = findBestMove();
                        makeMove(bestMove.row, bestMove.col, aiPlayer);
                    }, 500); // Delay AI move
                }
            }
        }

        function makeMove(row, col, player) {
            board[row][col] = player;
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            cell.innerText = player;
            cell.classList.add(player.toLowerCase());
            cell.removeEventListener('click', handleCellClick);
            if (checkWin(player)) {
                winnerDisplay.innerText = `${player === humanPlayer ? "You win!" : "AI wins!"}`;
                gameBoard.querySelectorAll('.cell').forEach(cell => cell.removeEventListener('click', handleCellClick));
            } else if (isBoardFull()) {
                winnerDisplay.innerText = "It's a draw!";
            }
        }

        function checkWin(player) {
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize; col++) {
                    if (
                        checkDirection(row, col, player, 1, 0) || // Kiểm tra hàng ngang
                        checkDirection(row, col, player, 0, 1) || // Kiểm tra hàng dọc
                        checkDirection(row, col, player, 1, 1) || // Kiểm tra đường chéo chính
                        checkDirection(row, col, player, 1, -1)   // Kiểm tra đường chéo phụ
                    ) {
                        return true;
                    }
                }
            }
            return false;
        }

        function checkDirection(row, col, player, rowIncrement, colIncrement) {
            let count = 0;
            for (let i = 0; i < winCondition; i++) {
                const newRow = row + i * rowIncrement;
                const newCol = col + i * colIncrement;
                if (newRow >= 0 && newRow < boardSize && newCol >= 0 && newCol < boardSize && board[newRow][newCol] === player) {
                    count++;
                } else {
                    break;
                }
            }
            return count === winCondition;
        }

        function isBoardFull() {
            return board.flat().every(cell => cell !== "");
        }

        function findBestMove() {
            let bestMove = null;
            let bestScore = -Infinity;

            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize; col++) {
                    if (board[row][col] === "") {
                        board[row][col] = aiPlayer;
                        const score = minimax(board, 0, false);
                        board[row][col] = "";
                        if (score > bestScore) {
                            bestScore = score;
                            bestMove = { row, col };
                        }
                    }
                }
            }
            return bestMove;
        }

        function minimax(board, depth, isMaximizing) {
            if (checkWin(aiPlayer)) return 10 - depth;
            if (checkWin(humanPlayer)) return depth - 10;
            if (isBoardFull()) return 0;

            if (isMaximizing) {
                let bestScore = -Infinity;
                for (let row = 0; row < boardSize; row++) {
                    for (let col = 0; col < boardSize; col++) {
                        if (board[row][col] === "") {
                            board[row][col] = aiPlayer;
                            const score = minimax(board, depth + 1, false);
                            board[row][col] = "";
                            bestScore = Math.max(score, bestScore);
                        }
                    }
                }
                return bestScore;
            } else {
                let bestScore = Infinity;
                for (let row = 0; row < boardSize; row++) {
                    for (let col = 0; col < boardSize; col++) {
                        if (board[row][col] === "") {
                            board[row][col] = humanPlayer;
                            const score = minimax(board, depth + 1, true);
                            board[row][col] = "";
                            bestScore = Math.min(score, bestScore);
                        }
                    }
                }
                return bestScore;
            }
        }

        function resetGame() {
            board.forEach(row => row.fill(""));
            winnerDisplay.innerText = "Make your move!";
            createBoard();
        }
    </script>
</body>

</html>
